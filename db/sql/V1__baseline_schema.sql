-- MySQL dump 10.13  Distrib 8.0.41, for macos15 (x86_64)
--
-- Host: localhost    Database: sudoku_brain
-- ------------------------------------------------------
-- Server version	8.0.43

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Dumping data for table `attempted`
--

LOCK TABLES `attempted` WRITE;
/*!40000 ALTER TABLE `attempted` DISABLE KEYS */;
INSERT INTO `attempted` VALUES (1,9,'000003091000050000010000056056780910000000000200100000080005060000307020600918000',0,0,'2025-09-21'),(1,11,'427000001001620000068310902003000020090000603070000004000000000010200007800003000',0,0,'2025-09-21'),(1,12,'010000000090704000050000000780036054100007060000090000001008570000500409045200000',0,0,'2025-09-21'),(1,13,'015004000000080905800000130000006007572800000006000080001009000050732000090000050',0,0,'2025-09-21'),(1,14,'001700034780000000045000000500000007430000500006300000600197400000280000293000000',0,0,'2025-09-21'),(1,15,'000100700007000100610009243090400007374650092800000001040060000002000000000000020',81,0,'2025-09-21'),(1,16,'000400802000000040000168570043501000000004038000000000069000000080040953070010000',0,0,'2025-09-21'),(1,18,'003010000900200000020000300000000000000400000030809000040090607276305010000647280',0,0,'2025-09-21'),(1,19,'000006307030020000097000000768190005002030678040678000000000200003000000000000700',0,0,'2025-09-21'),(1,21,'007020000380045000410070005090001050000450000000082000030000000870004000064710000',0,0,'2025-09-21'),(1,24,'010030007006500300040070000060000280831020070000060905050090100680000700000000000',0,0,'2025-09-21'),(1,26,'900007000000480005000000091000070019104000080000940020049053062000000030000060050',0,0,'2025-09-21'),(1,27,'700100400000000009000680002800090200570001608002000005000010004003900007087000020',0,0,'2025-09-21'),(1,29,'000000000026010007000200601000002030000061000062000080650004070370000960208006000',0,0,'2025-09-21'),(1,31,'005100000100050009007802000010070804306080020000200000001720040700900000009000100',0,0,'2025-09-21'),(1,32,'004700010000000047000948000700800000010300700008007201020100000009000074000400603',0,0,'2025-09-21'),(1,33,'000018420849230000020000000000000000000002346060070800900045108007000900610000000',11,0,'2025-09-21'),(1,36,'000000009050000002600004350080035000007410800005800000060040007500060400042900000',0,0,'2025-09-21'),(1,37,'001000032000010507950000000007481000400070000010690000500036200000020600200000003',0,0,'2025-09-21'),(1,39,'090420000230000000007001423005000000403007800000002040000008709900040085000009000',0,0,'2025-09-21'),(1,40,'040000920005000400982304500800000000000000307720600005200000080034000600090100000',0,0,'2025-09-21'),(1,41,'080000007000038400005000300000050009500000000098104073910080040706400000000070030',0,0,'2025-09-21'),(1,44,'820130075000008090170040008000000019007800000900000030000370050000000007704600000',0,0,'2025-09-21'),(1,45,'480790203000000891000000700000000070106200009008060040040002000001000030050906000',0,0,'2025-09-21'),(1,46,'007040058000708006805020040000030501000000800008010090600000700401007000050000004',0,0,'2025-09-21'),(1,47,'090002000000043012300000007010059006000020000000470000500918000089500000601030000',0,0,'2025-09-21'),(1,49,'800095000100600800000081209701240000000000000600000000900020000000107000500964710',0,0,'2025-09-21'),(1,50,'504000009000039004000042000905060080008010000100780300000007600070800000090400070',0,0,'2025-09-21'),(1,53,'000000600000000080000000000061023900002009160400671803018000000020900000030086200',0,0,'2025-09-21'),(1,55,'000000060007800090000406070000500600009070000100603080400200730030080000002307010',0,0,'2025-09-21'),(1,56,'030000781090000200780000690003470006004000900805000300200000000000060402008000009',0,0,'2025-09-21');
/*!40000 ALTER TABLE `attempted` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping data for table `daily_attempt`
--

LOCK TABLES `daily_attempt` WRITE;
/*!40000 ALTER TABLE `daily_attempt` DISABLE KEYS */;
/*!40000 ALTER TABLE `daily_attempt` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping data for table `daily_puzzle`
--

LOCK TABLES `daily_puzzle` WRITE;
/*!40000 ALTER TABLE `daily_puzzle` DISABLE KEYS */;
/*!40000 ALTER TABLE `daily_puzzle` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping data for table `puzzle`
--

LOCK TABLES `puzzle` WRITE;
/*!40000 ALTER TABLE `puzzle` DISABLE KEYS */;
INSERT INTO `puzzle` VALUES (7,'700105092000002007109070300000600030300050070008000009000704023000020050000000700','764135892835492617129876345912647538346958271578213469651784923487329156293561784',25,'EASY'),(8,'200040013004000009090307000907002060020006070008100002000200000000690030000004050','265849713374521689891367524917482365423956871658173942536218497742695138189734256',25,'EASY'),(9,'000003091000050000010000056056780910000000000200100000080005060000307020600918000','574623891869451237312879456456782913137594682298136574781245369945367128623918745',25,'EASY'),(10,'029000007064590200700000000030700900900000830008000000400860000600000108003015000','129348567364597281785126493236784915947251836518639724471862359652973148893415672',25,'EASY'),(11,'427000001001620000068310902003000020090000603070000004000000000010200007800003000','427985361931627548568314972683149725194572683275836194752461839316298457849753216',25,'HARD'),(12,'010000000090704000050000000780036054100007060000090000001008570000500409045200000','417625893398714625256389741789136254123457968564892137631948572872563419945271386',25,'HARD'),(13,'015004000000080905800000130000006007572800000006000080001009000050732000090000050','315924768467183925829567134138246597572891346946375281281459673654732819793618452',25,'HARD'),(14,'001700034780000000045000000500000007430000500006300000600197400000280000293000000','961758234782934156345612879529461387437829561816375942658197423174283695293546718',25,'HARD'),(15,'000100700007000100610009243090400007374650092800000001040060000000000000000000020','452136789937284156618579243196428537374651892825397461249765318563812974781943625',25,'HARD'),(16,'000400802000000040000168570043501000000004038000000000069000000080040953070010000','596473812718295346234168579943581267657924138821637495469352781182746953375819624',25,'HARD'),(17,'010003080800400000000809000001904500000507010090000003020790000000100290000308004','915273486862451739734869125281934567346587912597612843428796351673145298159328674',25,'HARD'),(18,'003010000900200000020000300000000000000400000030809000040090607276305010000647280','453918762967234158128756394719523846582461973634879521845192637276385419391647285',25,'HARD'),(19,'000006307030020000097000000768190005002030678040678000000000200003000000000000700','824916357531427869697385142768192435912534678345678921156749283273861594489253716',25,'HARD'),(20,'000300040014000003023014009090020014000900020000006000000003450081000070000800030','568379142914285763723614589695728314847931625132546897276193458381452976459867231',25,'HARD'),(21,'007020000380045000410070005090001050000450000000082000030000000870004000064710000','657829143389145762412376895798631254123457689546982317231598476875264931964713528',25,'HARD'),(22,'008010300623457000090000000902000004006070000500039200000080000200000006000640070','458916327623457891791823645932568714816274539547139268169782453274395186385641972',25,'MEDIUM'),(23,'640000009700006300123009006000005900010000000050081200009030000000697800070000000','645123789798456312123879456284365971916742538357981264569238147431697825872514693',25,'MEDIUM'),(24,'010030007006500300040070000060000280831020070000060905050090100680000700000000000','915234867726589341348671592569147283831925476274863915457396128683412759192758634',25,'MEDIUM'),(25,'007000058080007000105689004000570400000010007500200009000800000000000030900740002','497321658682457391135689274269578413348916527571234869713862945824195736956743182',25,'MEDIUM'),(26,'900007000000480005000000091000070019104000080000940020049053062000000030000060050','952617348613489275478235691526378419194526783837941526749853162265194837381762954',25,'MEDIUM'),(27,'700100400000000009000680002800090200570001608002000005000010004003900007087000020','798123456621475389354689172846597213579231648132846795265718934413952867987364521',25,'MEDIUM'),(28,'000200000010379000009008067001803004000097000000050000067000005382005000400000030','738246951516379482249518367671823594854697123923154678167932845382465719495781236',25,'MEDIUM'),(29,'000000000026010007000200601000002030000061000062000080650004070370000960208006000','519637248426819357783245691945782136837461529162953784651394872374128965298576413',25,'MEDIUM'),(30,'000069002000025000000008950070000100090500004000981607040000000002600500000710008','758369412916425783234178956873246195691537824425981637147852369382694571569713248',25,'EXPERT'),(31,'005100000100050009007802000010070804306080020000200000001720040700900000009000100','895136472123457689467892315512673894346589721978214536631725948784961253259348167',25,'EXPERT'),(32,'004700010000000047000948000700800000010300700008007201020100000009000074000400603','564723819982651347173948562795812436216394758348567291427136985639285174851479623',25,'EXPERT'),(33,'000018420849230000020000000000000000000002346060070800900045108000000900610000000','576918423849236517123457689294863751758192346361574892932645178487321965615789234',25,'EXPERT'),(34,'000000000000000700901803006790000030008370204004000070100008000000401620009700001','485967312362145798971823456796284135518379264234516879127658943853491627649732581',25,'EXPERT'),(35,'190060000005090340000204001002009000030400280900300000000100002000045000701000060','194563728825791346367284951472859613536417289918326475649178532283645197751932864',25,'EXPERT'),(36,'000000009050000002600004350080035000007410800005800000060040007500060400042900000','124358679853679142679124358986235714237416895415897236368541927591762483742983561',25,'EXPERT'),(37,'001000032000010507950000000007481000400070000010690000500036200000020600200000003','761854932834219567952367841627481359489573126315692478578936214143728695296145783',25,'EXPERT'),(38,'001009030000405009090003000600030000900800620080200003300000400400076090009000300','751689234236415789894723156672934815943851627185267943317598462428376591569142378',25,'EXPERT'),(39,'090420000230000000007001423005000000403007800000002040000008709900040085000009000','691423578234785691857691423125864937463917852789352146546238719972146385318579264',25,'EXPERT'),(40,'040000920005000400982304500800000000000000307720600005200000080034000600090100000','641578923375291468982364571813457296456829317729613845267935184134782659598146732',25,'EXPERT'),(41,'080000007000038400005000300000050009500000000098104073910080040706400000000070030','389642157167538492245791368432857619571369824698124573913285746726413985854976231',25,'MEDIUM'),(42,'010000030930100000640003012090000400000007089200008000007006003380705020000000000','718529634932164578645873912891632457563417289274958361157296843389745126426381795',25,'MEDIUM'),(43,'010004007030090000500301000020900040370000010809000006000000103000000090090218005','918624357234795681567381924125936748376842519849157236482569173651473892793218465',25,'MEDIUM'),(44,'820130075000008090170040008000000019007800000900000030000370050000000007704600000','829136475546728391173945268485263719367891524912457836698374152231589647754612983',25,'MEDIUM'),(45,'480790203000000891000000700000000070106200009008060040040002000001000030050906000','485791263367425891912683754234859176176234589598167342849372615621548937753916428',25,'MEDIUM'),(46,'007040058000708006805020040000030501000000800008010090600000700401007000050000004','267143958394758126815629347926834571143975862578216493682491735431567289759382614',25,'MEDIUM'),(47,'090002000000043012300000007010059006000020000000470000500918000089500000601030000','196782345758643912324195687812359476473826159965471823537918264289564731641237598',25,'MEDIUM'),(48,'006000014030004600010000050500000000079000400080000035000800000702009040801600029','256387914938514672417926358523468791179235486684791235395842167762159843841673529',25,'MEDIUM'),(49,'800095000100600800000081209701240000000000000600000000900020000000107000500964710','872495136193672845465381279751246398384519627629738451917823564246157983538964712',25,'MEDIUM'),(50,'504000009000039004000042000905060080008010000100780300000007600070800000090400070','514678239627539814389142567935264781768913425142785396851397642476821953293456178',25,'MEDIUM'),(51,'020001607000008003000000200030005060060000001578000304090000042210009000800000030','324591687156278493789634215431725968962843751578916324695387142213459876847162539',25,'MEDIUM'),(52,'000060010803000007010007008080000003600500000051706200000873005000600070040002000','475368912863921547912457368784219653629534781351786294196873425238645179547192836',25,'MEDIUM'),(53,'000000600000000080000000000061023900002009160400671803018000000020900000030086200','743598612256134789189267345861423957372859164495671823918342576627915438534786291',25,'MEDIUM'),(54,'700006000609000000004000200970001005041600020003005000000102804007000000010700530','725846391689213457134579286978321645541687923263495718396152874857934162412768539',25,'MEDIUM'),(55,'000000060007800090000406070000500600009070000100603080400200730030080000002307010','514729368267831495893456172378592641649178253125643987486215739731984526952367814',25,'MEDIUM'),(56,'030000781090000200780000690003470006004000900805000300200000000000060402008000009','532946781496781253781253694923475816674318925815692347247539168159867432368124579',25,'MEDIUM');
/*!40000 ALTER TABLE `puzzle` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping data for table `puzzle_template`
--

LOCK TABLES `puzzle_template` WRITE;
/*!40000 ALTER TABLE `puzzle_template` DISABLE KEYS */;
/*!40000 ALTER TABLE `puzzle_template` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping data for table `solved`
--

LOCK TABLES `solved` WRITE;
/*!40000 ALTER TABLE `solved` DISABLE KEYS */;
INSERT INTO `solved` VALUES (1,7,'764135892835492617129876345912647538346958271578213469651784923487329156293561784',265,0,'2025-09-21','2025-09-21',NULL);
/*!40000 ALTER TABLE `solved` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping data for table `users`
--

LOCK TABLES `users` WRITE;
/*!40000 ALTER TABLE `users` DISABLE KEYS */;
INSERT INTO `users` VALUES (1,'GOOGLE','112940491773523240633','Alexmeb81@outlook.com','alexbuckley','https://lh3.googleusercontent.com/a/ACg8ocJX7SszHvl8fFa1JZvxeRW1oYDyhSnaglFZN9PdfW5FRn4e49A=s96-c','2025-09-21 02:34:42');
/*!40000 ALTER TABLE `users` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Dumping events for database 'sudoku_brain'
--

--
-- Dumping routines for database 'sudoku_brain'
--
/*!50003 DROP PROCEDURE IF EXISTS `GetAttemptedPuzzle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetAttemptedPuzzle`(IN in_username VARCHAR(20), in_puzzle_id INT)
BEGIN
	SELECT p.puzzle_id,
		p.puzzle_vals,
        p.solution_vals,
        a.current_state,
        a.username,
        a.seconds_worked_on,
        a.hints_used,
        a.started_on
	FROM attempted a
		JOIN puzzle p
			ON a.puzzle_id = p.puzzle_id
	WHERE a.username = in_username
		AND a.puzzle_id = in_puzzle_id
	;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAttemptedPuzzles` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetAttemptedPuzzles`(IN username VARCHAR(20))
BEGIN
	SELECT p.puzzle_id,
		p.puzzle_vals,
        p.solution_vals,
        a.seconds_worked_on,
        a.hints_used,
        a.started_on
	FROM users u
		JOIN attempted a
			ON u.user_id = a.user_id
		JOIN puzzle p
			ON a.puzzle_id = p.puzzle_id
	WHERE u.username = username
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetLeaderboard` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetLeaderboard`(IN page_offset INT, IN page_size INT)
BEGIN
	SELECT u.username,
		COALESCE(COUNT(s.puzzle_id), 0)			AS puzzles_solved,
        COALESCE(AVG(s.seconds_worked_on), 0) 	AS avg_solve_time,
        COALESCE(AVG(s.hints_used), 0)			AS avg_hints_used
	FROM users u
		LEFT JOIN solved s
			ON u.user_id = s.user_id
	GROUP BY u.username
    ORDER BY puzzles_solved DESC
    LIMIT page_size
    OFFSET page_offset
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetNumSolved` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetNumSolved`(
	IN puzzle_id INT,
    OUT numSolved INT
)
BEGIN
	SELECT COUNT(*)
		INTO numSolved
	FROM puzzle p
		JOIN solved s
			ON p.puzzle_id = s.puzzle_id
	WHERE p.puzzle_id = puzzle_id
	GROUP BY p.puzzle_id;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetNumUsers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetNumUsers`()
BEGIN
	SELECT COUNT(*) AS num_users
    FROM users
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPuzzle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetPuzzle`(IN puzzle_id INT)
BEGIN
	WITH attempted_by AS (
		SELECT COUNT(*) AS num_attempted
        FROM puzzle p
			JOIN attempted a
				ON p.puzzle_id = puzzle_id
		WHERE p.puzzle_id = puzzle_id
        GROUP BY p.puzzle_id
    )
    
    SELECT p.puzzle_id,
		p.puzzle_vals,
        p.solution_vals,
        a.num_attempted AS attempted_by,
        COUNT(*) AS solved_by,
        AVG(s.rating) AS avg_rating
	FROM puzzle p
		JOIN attempted_by a
			ON p.puzzle_id = a.puzzle_id
		JOIN solved s
			ON p.puzzle_id = s.puzzle_id
	WHERE p.puzzle_id = puzzle_id
    GROUP BY p.puzzle_id, 
		p.puzzle_vals,
		p.solution_vals
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPuzzleLeaders` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetPuzzleLeaders`(IN in_puzzle_id INT)
BEGIN
	SELECT username,
		seconds_to_solve,
        solved_on
	FROM solved
    WHERE hints_used = 0
    ORDER BY seconds_to_solve DESC
    LIMIT 3
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetPuzzleMetrics` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetPuzzleMetrics`(IN in_puzzle_id INT)
BEGIN
	WITH attempted_by AS (
		SELECT p.puzzle_id,
		CAST(COUNT(*) AS UNSIGNED)					AS num_attempted,
		CAST(SUM(a.seconds_worked_on) AS UNSIGNED) 	AS total_seconds,
        CAST(SUM(a.hints_used) AS UNSIGNED) 		AS total_hints_used
        FROM puzzle p
			JOIN attempted a
				ON p.puzzle_id = a.puzzle_id
		WHERE p.puzzle_id = in_puzzle_id
        GROUP BY p.puzzle_id
    ),
	solved_by AS (
		SELECT puzzle_id,
			CAST(COUNT(*) AS UNSIGNED) 				AS num_solved,
			AVG(rating) 							AS avg_rating,
            CAST(COUNT(rating) AS UNSIGNED) 		AS num_rated,
			CAST(SUM(seconds_worked_on) AS UNSIGNED) AS time_worked_on,
            AVG(seconds_worked_on)					AS avg_solve_time,
            AVG(hints_used)							AS avg_hints_used,
            CAST(SUM(hints_used) AS UNSIGNED)		AS total_hints_used
		FROM solved
        WHERE puzzle_id = in_puzzle_id
        GROUP BY puzzle_id
    ),
    record AS (
		SELECT s.puzzle_id,
			u.username,
			s.seconds_worked_on,
			s.solved_on
		FROM solved s
			JOIN users u
				ON s.user_id = u.user_id
        WHERE s.hints_used = 0 AND s.puzzle_id = in_puzzle_id
        ORDER BY s.seconds_worked_on
        LIMIT 1
    )
    
    SELECT COALESCE(s.num_solved, 0)										AS num_solved,
		(COALESCE(a.num_attempted, 0) + COALESCE(s.num_solved, 0))			AS num_attempted,
        COALESCE(s.avg_rating, -1)											AS avg_rating,
        COALESCE(s.num_rated, 0)											AS num_rated,
        COALESCE(s.avg_solve_time, -1)										AS avg_solve_time,
		(COALESCE(s.time_worked_on, 0) + COALESCE(a.total_seconds, 0))		AS total_seconds,
		COALESCE(s.avg_hints_used, -1)										AS avg_hints_used,
		(COALESCE(s.total_hints_used, 0) + COALESCE(a.total_hints_used, 0))	AS total_hints_used,
        r.seconds_worked_on											AS record,
		r.username		 													AS record_holder,
        r.solved_on															AS record_date
        
	FROM puzzle p
		LEFT JOIN attempted_by a
			ON p.puzzle_id = a.puzzle_id
		LEFT JOIN record r
			ON p.puzzle_id = r.puzzle_id
		LEFT JOIN solved_by s
			ON p.puzzle_id = s.puzzle_id
    WHERE in_puzzle_id = p.puzzle_id
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetSolvedPuzzles` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetSolvedPuzzles`(IN username VARCHAR(20))
BEGIN
	SELECT p.puzzle_id,
		p.puzzle_vals,
        p.solution_vals,
        s.seconds_to_solve,
        s.hints_used,
		s.rating,
        s.started_on,
        s.solved_on
	FROM users u
		JOIN solved s
			ON u.username = s.username
		JOIN puzzle p
			ON s.puzzle_id = p.puzzle_id
	WHERE u.username = username
    ;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2025-09-22 10:35:34
